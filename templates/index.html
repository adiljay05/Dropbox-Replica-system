<!doctype html>
<html>

<head>
    <title>Welcome to Dropbox Replica System</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <script src="https://www.gstatic.com/firebasejs/ui/4.4.0/firebase-ui-auth.js"></script>
    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/4.4.0/firebase-ui-auth.css" />
    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <link type="text/css" rel="stylesheet" href="{{ url_for('static',filename='style.css') }}">
    <script src="/static/scripts.js"></script>
</head>

<body>
    <h1>Welcome to Dropbox Replica System</h1>
    <div id="firebase-auth-container"></div>
    <button id="sign-out" class="btn btn-danger" hidden="true">Sign out</button>
    <div id="login-info" hidden="true">
		<hr>
		{% if session['name'] %}
            <p>{{ session['name'] }}</p>
            <form action="/add_directory" method="post">
                Directory Name: <input type="text" required placeholder="Enter directory Name" name="dir_name"/>
                <input type="hidden" name="cur_dir" value="{{ cur_dir }}">
                <input type="submit" value="Add"/>
            </form>
            <form action="/upload_file" method="post" enctype="multipart/form-data">
                <input type="hidden" name="cur_dir" value="{{ cur_dir }}">
                Upload File: <input type="file" name="file_name" /><input type="submit"/>
            </form>
            <form action="/check_duplicates_entire_storage" method="POST">
                <input type="submit" value="check duplicates from entire storage">
            </form>
            <hr>
            <div align=center>
                Current Directory: {{ cur_dir }}
            </div>
            <table align="center">
                <th>Sr. No.</th>
                <th>Name</th>
                <th>Actions</th>
                {% if cur_dir!="/" %}
                    <tr>
                        <td colspan="3">
                            <form action="/go_to_previous_directory" id="back_form" method="POST">
                                <input type="hidden" name="cur_dir" value="{{ cur_dir }}">
                                <a href="#" onclick="document.getElementById('back_form').submit()">..</a>
                            </form>
                        </td>
                    </tr>
                {% endif %}
                {% set vars = {'count': 1} %}
                {% for i in dir_list %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>
                        <form action="/change_dir" id="form{{ loop.index }}" method="POST">
                            <input type="hidden" name="cur_dir" value="{{ cur_dir }}">
                            <input type="hidden" name="directory_name" value="{{ i['directory_name'] }}">
                            <a href="#" onclick="document.getElementById('form{{ loop.index }}').submit()"> {{ i['directory_name'] }} </a>
                        </form>
                    </td>
                    <td>
                        <form action="/delete_directory" method="POST">
                            <input type="hidden" name="dir_name" value="{{ i['directory_name'] }}">
                            <input type="hidden" name="cur_dir" value="{{ cur_dir }}">
                            <input type="submit" class="btn btn-danger" value="Delete">
                        </form>
                    </td>
                </tr>
                {% if vars.update({'count': vars.count + 1}) %}{% endif %}
                {% endfor %}
                {% for i in file_list %}
                <tr>
                    <td>
                        {{ vars.count }}
                    </td>
                    <td>
                        {{ i['file_name'] }}
                    </td>
                    <td>
                        <form action="/delete_file" method="POST">
                            <input type="hidden" name="file_name" value="{{ i['file_name'] }}">
                            <input type="hidden" name="cur_dir" value="{{ cur_dir }}">
                            <input type="submit" class="btn btn-danger" value="Delete">
                        </form>
                    </td>
                </tr>
                {% if vars.update({'count': vars.count + 1}) %}{% endif %}
                {% endfor %}
                
            </table>
		{% elif error_message %}
		<p>Error Message: {{ error_message }}</p>
		{% endif %}
    </div>
</body>

<script src="https://www.gstatic.com/firebasejs/7.14.5/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.8.0/firebase-auth.js"></script>
<script src="{{ url_for('static', filename='app-setup.js') }}"></script>

</html>